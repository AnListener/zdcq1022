<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GIS一张图 - 高速公路征地拆迁管理系统</title>
    <!-- 本地CSS -->
    <link href="./styles.css" rel="stylesheet" id="local-css">
    <!-- CDN作为备用 -->
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" id="cdn-css" onload="checkCDNLoad()" onerror="fallbackToLocal()">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script>
        // 检查是否在iframe中运行，如果不是则重定向到app.html
        if (window.self === window.top) {
            // 不在iframe中，重定向到app.html并加载此页面
            const currentPage = window.location.pathname.substring(1); // 移除开头的斜杠
            window.location.href = '/index.html?page=' + encodeURIComponent(currentPage);
        }
        
        // 检查CDN是否加载成功
        function checkCDNLoad() {
            // 创建一个测试元素来检测Tailwind是否加载成功
            const test = document.createElement('div');
            test.className = 'bg-blue-500';
            test.style.visibility = 'hidden';
            test.style.position = 'absolute';
            document.body.appendChild(test);
            
            // 获取计算后的样式
            const computedStyle = window.getComputedStyle(test);
            const backgroundColor = computedStyle.backgroundColor;
            
            // 移除测试元素
            document.body.removeChild(test);
            
            // 如果背景颜色不是蓝色，说明CDN没有正确加载
            if (backgroundColor !== 'rgb(59, 130, 246)' && backgroundColor !== '#3b82f6') {
                console.warn('CDN CSS failed to load, using local CSS');
                fallbackToLocal();
            } else {
                console.log('CDN CSS loaded successfully');
                // 隐藏本地CSS以避免冲突
                document.getElementById('local-css').disabled = true;
            }
        }
        
        // CDN加载失败时的备用方案
        function fallbackToLocal() {
            console.log('Switching to local CSS fallback');
            const cdnCSS = document.getElementById('cdn-css');
            const localCSS = document.getElementById('local-css');
            
            if (cdnCSS) {
                cdnCSS.disabled = true;
            }
            
            if (localCSS) {
                localCSS.disabled = false;
            }
        }
        
        // 页面加载完成后检查CSS是否加载成功
        window.addEventListener('load', function() {
            // 延迟检查以确保样式完全应用
            setTimeout(checkCDNLoad, 100);
        });
        
        // 网络错误处理
        window.addEventListener('error', function(e) {
            if (e.target.tagName === 'LINK' && e.target.id === 'cdn-css') {
                console.warn('CDN CSS failed to load, using local CSS');
                fallbackToLocal();
            }
        }, true);
    </script>
    
    <style>
        /* 自定义样式 */
        .map-container {
            height: calc(100vh - 180px);
            position: relative;
            overflow: hidden;
            border-radius: 0.5rem;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .toolbar-button {
            transition: all 0.2s ease;
        }
        
        .toolbar-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
        }
        
        .legend-item {
            display: flex;
            align-items: center;
            padding: 0.25rem 0;
        }
        
        .legend-color {
            width: 16px;
            height: 16px;
            border-radius: 2px;
            margin-right: 0.5rem;
            border: 1px solid #ddd;
        }
        
        .layer-item {
            transition: background-color 0.2s;
        }
        
        .layer-item:hover {
            background-color: #f3f4f6;
        }
        
        .active-layer {
            background-color: #dbeafe;
            border-left: 3px solid #3b82f6;
        }
        
        .map-control {
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
        }
        
        .info-panel {
            max-height: 300px;
            overflow-y: auto;
        }
        
        /* 响应式调整 */
        @media (max-width: 768px) {
            .map-container {
                height: 400px;
            }
            
            .toolbar-row {
                flex-direction: column;
                align-items: stretch;
            }
            
            .toolbar-group {
                margin-bottom: 0.5rem;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- 全屏容器 -->
    <div class="p-4 md:p-6 h-full">
        <!-- 页面标题 -->
        <div class="mb-4 md:mb-6">
            <h1 class="text-xl md:text-2xl font-bold text-gray-800 flex items-center">
                <i class="fas fa-map-marked-alt text-blue-500 mr-2"></i>
                GIS一张图
            </h1>
            <p class="text-gray-600 mt-1 text-sm md:text-base">综合展示所有GIS信息的一张图，支持多维度数据可视化</p>
        </div>

        <!-- 主要内容区域 -->
        <div class="flex flex-col lg:flex-row gap-4 md:gap-6">
            <!-- 左侧控制面板 -->
            <div class="w-full lg:w-80 flex-shrink-0 space-y-4 md:space-y-6">
                <!-- 图层控制面板 -->
                <div class="bg-white rounded-xl shadow-lg p-4">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-base md:text-lg font-bold text-gray-800 flex items-center">
                            <i class="fas fa-layer-group text-blue-500 mr-2"></i>
                            图层控制
                        </h2>
                        <button class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-sync-alt"></i>
                        </button>
                    </div>
                    
                    <div class="space-y-2 max-h-60 overflow-y-auto">
                        <div class="layer-item active-layer p-2 rounded cursor-pointer flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                <span>征地范围</span>
                            </div>
                            <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">24</span>
                        </div>
                        <div class="layer-item p-2 rounded cursor-pointer flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="far fa-circle text-gray-400 mr-2"></i>
                                <span>建筑物</span>
                            </div>
                            <span class="text-xs bg-green-100 text-green-800 px-2 py-1 rounded">156</span>
                        </div>
                        <div class="layer-item active-layer p-2 rounded cursor-pointer flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                <span>道路网络</span>
                            </div>
                            <span class="text-xs bg-yellow-100 text-yellow-800 px-2 py-1 rounded">42</span>
                        </div>
                        <div class="layer-item p-2 rounded cursor-pointer flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="far fa-circle text-gray-400 mr-2"></i>
                                <span>河流水系</span>
                            </div>
                            <span class="text-xs bg-purple-100 text-purple-800 px-2 py-1 rounded">8</span>
                        </div>
                        <div class="layer-item active-layer p-2 rounded cursor-pointer flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="fas fa-check-circle text-green-500 mr-2"></i>
                                <span>项目标注</span>
                            </div>
                            <span class="text-xs bg-red-100 text-red-800 px-2 py-1 rounded">24</span>
                        </div>
                        <div class="layer-item p-2 rounded cursor-pointer flex items-center justify-between">
                            <div class="flex items-center">
                                <i class="far fa-circle text-gray-400 mr-2"></i>
                                <span>行政区划</span>
                            </div>
                            <span class="text-xs bg-indigo-100 text-indigo-800 px-2 py-1 rounded">12</span>
                        </div>
                    </div>
                </div>
                
                <!-- 统计信息面板 -->
                <div class="bg-white rounded-xl shadow-lg p-4">
                    <h2 class="text-base md:text-lg font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-chart-bar text-green-500 mr-2"></i>
                        数据统计
                    </h2>
                    
                    <div class="space-y-3">
                        <div class="flex justify-between items-center pb-2 border-b border-gray-100">
                            <span class="text-gray-600">征地总面积</span>
                            <span class="font-semibold">1,245.6 亩</span>
                        </div>
                        <div class="flex justify-between items-center pb-2 border-b border-gray-100">
                            <span class="text-gray-600">拆迁建筑物</span>
                            <span class="font-semibold">156 栋</span>
                        </div>
                        <div class="flex justify-between items-center pb-2 border-b border-gray-100">
                            <span class="text-gray-600">涉及农户</span>
                            <span class="font-semibold">1,248 户</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600">项目总数</span>
                            <span class="font-semibold">24 个</span>
                        </div>
                    </div>
                </div>
                
                <!-- 查询面板 -->
                <div class="bg-white rounded-xl shadow-lg p-4">
                    <h2 class="text-base md:text-lg font-bold text-gray-800 mb-3 flex items-center">
                        <i class="fas fa-search text-purple-500 mr-2"></i>
                        快速查询
                    </h2>
                    
                    <div class="space-y-3">
                        <input type="text" placeholder="搜索项目名称、区域..." class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <button class="w-full bg-blue-500 hover:bg-blue-600 text-white py-2 rounded-lg transition-colors">
                            <i class="fas fa-search mr-1"></i> 查询
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- 右侧地图主区域 -->
            <div class="flex-1 flex flex-col">
                <!-- 地图操作工具栏 -->
                <div class="bg-white rounded-xl shadow-lg p-3 md:p-4 mb-4">
                    <div class="flex flex-wrap items-center justify-between gap-2">
                        <div class="flex flex-wrap gap-1 md:gap-2">
                            <button class="toolbar-button px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center text-sm">
                                <i class="fas fa-search-plus mr-1"></i> 放大
                            </button>
                            <button class="toolbar-button px-3 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 flex items-center text-sm">
                                <i class="fas fa-search-minus mr-1"></i> 缩小
                            </button>
                            <button class="toolbar-button px-3 py-2 bg-gray-500 text-white rounded-lg hover:bg-gray-600 flex items-center text-sm">
                                <i class="fas fa-sync-alt mr-1"></i> 刷新
                            </button>
                            <button class="toolbar-button px-3 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 flex items-center text-sm">
                                <i class="fas fa-location-arrow mr-1"></i> 定位
                            </button>
                            <button class="toolbar-button px-3 py-2 bg-purple-500 text-white rounded-lg hover:bg-purple-600 flex items-center text-sm">
                                <i class="fas fa-draw-polygon mr-1"></i> 测量
                            </button>
                        </div>
                        
                        <div class="flex flex-wrap gap-1 md:gap-2">
                            <select class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                                <option>广东省</option>
                                <option>广州市</option>
                                <option>深圳市</option>
                                <option>珠海市</option>
                            </select>
                            <select class="px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm">
                                <option>全部项目</option>
                                <option>进行中</option>
                                <option>已完成</option>
                                <option>未开始</option>
                            </select>
                        </div>
                    </div>
                </div>
                
                <!-- 地图展示区域 -->
                <div class="map-container bg-gradient-to-br from-blue-50 to-green-50 relative">
                    <!-- 模拟GIS地图 -->
                    <div class="absolute inset-0">
                        <!-- 模拟地图背景 -->
                        <div class="absolute inset-0 bg-gradient-to-br from-blue-100 to-green-100">
                            <!-- 模拟道路网络 -->
                            <div class="absolute top-1/4 left-0 right-0 h-1 bg-gray-700"></div>
                            <div class="absolute top-1/2 left-0 right-0 h-2 bg-gray-800"></div>
                            <div class="absolute top-3/4 left-0 right-0 h-1 bg-gray-700"></div>
                            <div class="absolute top-0 bottom-0 left-1/4 w-1 bg-gray-700"></div>
                            <div class="absolute top-0 bottom-0 left-1/2 w-2 bg-gray-800"></div>
                            <div class="absolute top-0 bottom-0 left-3/4 w-1 bg-gray-700"></div>
                            
                            <!-- 模拟河流 -->
                            <div class="absolute top-1/5 left-1/6 w-2/3 h-1 bg-blue-400 rounded-full"></div>
                            
                            <!-- 模拟征地范围 -->
                            <div class="absolute top-1/4 left-1/5 w-20 h-16 border-2 border-yellow-500 bg-yellow-200 bg-opacity-50"></div>
                            <div class="absolute top-1/3 left-2/5 w-24 h-20 border-2 border-yellow-500 bg-yellow-200 bg-opacity-50"></div>
                            <div class="absolute bottom-1/4 right-1/4 w-28 h-24 border-2 border-yellow-500 bg-yellow-200 bg-opacity-50"></div>
                            
                            <!-- 模拟建筑物 -->
                            <div class="absolute top-1/3 left-1/6 w-6 h-10 bg-red-400"></div>
                            <div class="absolute top-2/5 left-2/5 w-8 h-12 bg-red-500"></div>
                            <div class="absolute bottom-1/3 right-1/3 w-10 h-14 bg-red-600"></div>
                            
                            <!-- 模拟标记点 -->
                            <div class="absolute top-1/3 left-1/4 w-4 h-4 bg-blue-500 rounded-full"></div>
                            <div class="absolute top-2/5 right-1/3 w-4 h-4 bg-red-500 rounded-full"></div>
                            <div class="absolute bottom-1/4 left-1/3 w-4 h-4 bg-green-500 rounded-full"></div>
                            
                            <!-- 模拟项目标注 -->
                            <div class="absolute top-1/4 left-1/5 transform -translate-x-1/2 -translate-y-1/2">
                                <div class="bg-white bg-opacity-90 rounded-lg shadow-md p-2 text-xs">
                                    <div class="font-bold text-gray-800">广州南站扩建项目</div>
                                    <div class="text-gray-600">征地: 125亩</div>
                                </div>
                            </div>
                            
                            <div class="absolute top-1/3 right-1/4 transform translate-x-1/2 -translate-y-1/2">
                                <div class="bg-white bg-opacity-90 rounded-lg shadow-md p-2 text-xs">
                                    <div class="font-bold text-gray-800">白云机场连接线</div>
                                    <div class="text-gray-600">征地: 210亩</div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- 地图控件 -->
                        <div class="absolute top-4 right-4 bg-white rounded-lg shadow-md p-2 map-control">
                            <div class="flex flex-col space-y-1">
                                <button class="p-2 hover:bg-gray-100 rounded toolbar-button">
                                    <i class="fas fa-plus"></i>
                                </button>
                                <button class="p-2 hover:bg-gray-100 rounded toolbar-button">
                                    <i class="fas fa-minus"></i>
                                </button>
                                <button class="p-2 hover:bg-gray-100 rounded toolbar-button">
                                    <i class="fas fa-compass"></i>
                                </button>
                                <button class="p-2 hover:bg-gray-100 rounded toolbar-button">
                                    <i class="fas fa-location-arrow"></i>
                                </button>
                            </div>
                        </div>
                        
                        <!-- 图例 -->
                        <div class="absolute bottom-4 left-4 bg-white bg-opacity-90 rounded-lg shadow-md p-3 map-control">
                            <h4 class="font-semibold text-gray-800 mb-2 text-sm">图例</h4>
                            <ul class="space-y-1 text-xs">
                                <li class="legend-item">
                                    <div class="legend-color bg-yellow-200 border-2 border-yellow-500"></div>
                                    <span>征地范围</span>
                                </li>
                                <li class="legend-item">
                                    <div class="legend-color bg-red-500"></div>
                                    <span>建筑物</span>
                                </li>
                                <li class="legend-item">
                                    <div class="legend-color bg-gray-700"></div>
                                    <span>道路</span>
                                </li>
                                <li class="legend-item">
                                    <div class="legend-color bg-blue-400 rounded-full"></div>
                                    <span>河流</span>
                                </li>
                                <li class="legend-item">
                                    <div class="legend-color bg-green-500 rounded-full"></div>
                                    <span>项目点</span>
                                </li>
                            </ul>
                        </div>
                        
                        <!-- 比例尺 -->
                        <div class="absolute bottom-4 right-4 bg-white bg-opacity-90 rounded-lg shadow-md p-2 text-xs map-control">
                            <div class="flex items-center">
                                <div class="w-16 h-1 bg-black mr-2"></div>
                                <span>1:5000</span>
                            </div>
                        </div>
                        
                        <!-- 坐标显示 -->
                        <div class="absolute top-4 left-4 bg-white bg-opacity-90 rounded-lg shadow-md p-2 text-xs map-control">
                            <div>经度: 113.2644°</div>
                            <div>纬度: 23.1291°</div>
                        </div>
                    </div>
                </div>
                
                <!-- 项目信息面板 -->
                <div class="bg-white rounded-xl shadow-lg p-4 mt-4">
                    <div class="flex justify-between items-center mb-3">
                        <h2 class="text-base md:text-lg font-bold text-gray-800 flex items-center">
                            <i class="fas fa-info-circle text-indigo-500 mr-2"></i>
                            选中项目信息
                        </h2>
                        <button class="text-gray-500 hover:text-gray-700">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div class="info-panel">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-2">基本信息</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">项目名称:</span>
                                        <span>广州南站扩建项目</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">项目编号:</span>
                                        <span>XM-2023-001</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">项目状态:</span>
                                        <span class="text-green-600">进行中</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">所属区域:</span>
                                        <span>广州市番禺区</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div>
                                <h3 class="font-semibold text-gray-700 mb-2">征地信息</h3>
                                <div class="space-y-2 text-sm">
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">征地面积:</span>
                                        <span>125 亩</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">拆迁户数:</span>
                                        <span>48 户</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">建筑物:</span>
                                        <span>12 栋</span>
                                    </div>
                                    <div class="flex justify-between">
                                        <span class="text-gray-600">补偿金额:</span>
                                        <span>¥2,450,000</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-4">
                            <h3 class="font-semibold text-gray-700 mb-2">进度信息</h3>
                            <div class="w-full bg-gray-200 rounded-full h-2">
                                <div class="bg-blue-600 h-2 rounded-full" style="width: 65%"></div>
                            </div>
                            <div class="flex justify-between text-xs text-gray-600 mt-1">
                                <span>已完成 65%</span>
                                <span>预计完成时间: 2024-06-30</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 资源加载管理器 -->
    <script src="./resource-loader.js"></script>
    
    <!-- 资源状态检查工具 -->
    <script src="./resource-status-checker.js"></script>
    
    <script>
        // 页面特定脚本
        document.addEventListener('DOMContentLoaded', function() {
            console.log('GIS一张图页面加载完成');
            
            // 图层控制功能
            const layerItems = document.querySelectorAll('.layer-item');
            layerItems.forEach(item => {
                item.addEventListener('click', function(e) {
                    // 阻止事件冒泡，避免影响父页面
                    e.stopPropagation();
                    
                    // 切换图层选中状态
                    const icon = this.querySelector('i');
                    if (icon.classList.contains('fa-check-circle')) {
                        icon.classList.remove('fa-check-circle', 'text-green-500');
                        icon.classList.add('far', 'fa-circle', 'text-gray-400');
                        this.classList.remove('active-layer');
                    } else {
                        icon.classList.remove('far', 'fa-circle', 'text-gray-400');
                        icon.classList.add('fas', 'fa-check-circle', 'text-green-500');
                        this.classList.add('active-layer');
                    }
                });
            });
            
            // 地图操作按钮功能
            const mapButtons = document.querySelectorAll('.toolbar-button');
            mapButtons.forEach(button => {
                button.addEventListener('click', function(e) {
                    // 阻止事件冒泡，避免影响父页面
                    e.stopPropagation();
                    
                    const action = this.querySelector('i').className;
                    console.log('执行地图操作:', action);
                    
                    // 添加点击效果
                    this.classList.add('scale-95');
                    setTimeout(() => {
                        this.classList.remove('scale-95');
                    }, 100);
                });
            });
            
            // 防止其他点击事件冒泡到父页面
            document.addEventListener('click', function(e) {
                // 阻止事件冒泡，避免影响父页面
                e.stopPropagation();
            });
        });
    </script>
</body>
</html>